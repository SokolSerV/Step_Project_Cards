import{deskText,listCards,btnLogin,btnCreateVisit,btnUnlogin,closeBtnLogin,btnFilter,setToken,closeBtnVisit,formLogin,formVisit,modalVisit,btnFormVisit}from"./constants.js";import Modal from"./Modal.js";import Requests from"./Requests.js";import Card from"./Card.js";import Filter from"./Filter.js";const modal=new Modal,card=new Card;localStorage.getItem("token")&&(btnLogin.classList.add("hidden"),btnCreateVisit.classList.remove("hidden"),btnUnlogin.classList.remove("hidden"),setToken(localStorage.getItem("token")),Requests.get().then(e=>{e&&card.renderAll(e)}).catch(e=>alert(e))),btnLogin.addEventListener("click",()=>{modal.openModalLogin()}),formLogin.addEventListener("submit",e=>{e.preventDefault(),modal.handlerFormLogin()}),closeBtnLogin.addEventListener("click",()=>{modal.closeModal()}),btnUnlogin.addEventListener("click",()=>{localStorage.setItem("token",""),setToken(void 0),btnLogin.classList.remove("hidden"),btnCreateVisit.classList.add("hidden"),btnUnlogin.classList.add("hidden"),listCards.innerHTML="",deskText.classList.remove("hidden")}),btnFilter.addEventListener("click",()=>{(new Filter).getFilter()}),btnCreateVisit.addEventListener("click",()=>{modal.openModalNewVisit()}),modalVisit.addEventListener("click",e=>{e.target!==closeBtnVisit&&e.target.closest(".modal__content")||(console.log("ok2"),modal.closeModal())}),formVisit.addEventListener("submit",e=>{e.preventDefault(),modal.handlerFormVisit()}),listCards.addEventListener("click",e=>{const t=e.target.closest("li"),s=t.dataset.id;e.target.matches(".btnSwowMore")&&(t.querySelectorAll(".hidden").forEach(e=>{e.classList.remove("hidden")}),e.target.classList.add("hidden")),e.target.matches(".btnShowLess")&&(t.querySelectorAll("p").forEach(e=>{e.classList.contains("fullname")||e.classList.contains("specialist")||e.classList.add("hidden")}),e.target.classList.add("hidden"),t.querySelector(".btnSwowMore").classList.remove("hidden")),e.target.matches(".btnEdit")&&(modal.openModalUpdateVisit(t),btnFormVisit.addEventListener("click",function e(t){t.preventDefault();modal.handlerFormVisit(s);btnFormVisit.removeEventListener("click",e)})),e.target.matches(".btnDel")&&(e=t.dataset.id,Requests.delete(e).then(e=>{console.log(e+" - The card has been deleted"),t.remove(),""===listCards.innerHTML&&deskText.classList.remove("hidden")}).catch(e=>alert(e)))});